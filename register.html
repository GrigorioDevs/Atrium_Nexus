<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Atrium Nexus - Cadastro</title>

<!-- Icon title -->
<link rel="icon" href="assets/img/logo_atrium.png" type="image/x-icon">

<!-- Fonte Roboto (mesma do home) -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',sans-serif}
:root{
  --c1:#00E0FF; --c2:#FF2FB9;
  --bg:#0B1622; --panel:#0F1E2C;
  --text:#E7EEF6; --muted:#9fb1c3;
  --border:rgba(255,255,255,.12);
}

html,body{height:100%;width:100%;background:var(--bg);display:flex;justify-content:center;align-items:center;color:var(--text)}

/* Container centralizado */
.container{width:100%;max-width:520px;padding:16px}

/* Card */
.card-cadastro{
  background:var(--panel);
  border-radius:16px;
  padding:26px 20px;
  width:100%;
  box-shadow:0 18px 40px rgba(0,0,0,.35);
  border:1px solid var(--border);
}
.card-cadastro h2{
  text-align:center;margin-bottom:18px;
  font-weight:800;letter-spacing:.2px;color:var(--text)
}

/* Labels e inputs */
.card-cadastro label{
  display:block;font-size:14px;margin:12px 0 6px;color:var(--text);font-weight:600
}
.card-cadastro input{
  width:100%;padding:12px;border-radius:10px;
  background:#0a1520;color:var(--text);
  border:1px solid rgba(0,224,255,.20);font-size:15px;outline:none;transition:.2s
}
.card-cadastro input::placeholder{color:#7d93a7}
.card-cadastro input:focus{border-color:rgba(0,224,255,.45)}

/* Botão */
.card-cadastro button{
  width:100%;padding:14px;border:none;border-radius:10px;
  background:linear-gradient(135deg,var(--c1),var(--c2));
  color:#00121E;font-size:16px;font-weight:800;cursor:pointer;transition:.25s;margin-top:6px;
  border:1px solid rgba(255,255,255,.25)
}
.card-cadastro button:hover{filter:brightness(1.08)}

/* Helpers e mensagens (opcional usar) */
.helper{font-size:12px;color:var(--muted);margin-top:4px}

/* Responsivo */
@media(max-width:768px){
  .card-cadastro{padding:22px 18px}
  .card-cadastro h2{font-size:22px}
}
@media(max-width:480px){
  .card-cadastro{padding:18px 14px}
  .card-cadastro h2{font-size:20px}
  .card-cadastro label,.card-cadastro input,.card-cadastro button{font-size:14px}
  body,html{padding:0 10px}
}
</style>
</head>
<body>
<div class="container">
  <div class="card-cadastro">
    <h2>Cadastro de Usuário</h2>
    <form id="formCadastro">
      <label>Nome Login</label>
      <input type="text" id="login" required placeholder="Seu nome de usuário">
      <label>Email</label>
      <input type="email" id="email" required placeholder="voce@empresa.com">
      <label for="cpf">CPF</label>
      <input type="text" id="cpf" maxlength="14" required placeholder="000.000.000-00">
      <div class="helper" id="cpfHelper"></div>
      <label>Telefone</label>
      <input type="tel" id="telefone" required placeholder="(11) 90000-0000">
      <label>Senha</label>
      <input type="password" id="senha" required placeholder="Crie uma senha">
      <label>Confirmar Senha</label>
      <input type="password" id="senhaConfirma" required placeholder="Repita a senha">
      <button type="submit">Cadastrar</button>
    </form>
  </div>
</div>

<script>
// Base da API (mesma da tela de login)
const API_BASE = "http://localhost:5253";

// Helper para deixar só dígitos (cpf, telefone)
function onlyDigits(v){
  return String(v || "").replace(/\D/g, "");
}

/* CPF (máscara simples) */
document.addEventListener('DOMContentLoaded', function() {
  const cpfInput = document.getElementById('cpf');
  const helper = document.getElementById('cpfHelper');
  if (cpfInput) {
    cpfInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g,'').slice(0,11);
      value = value
        .replace(/^(\d{3})(\d)/, '$1.$2')
        .replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3')
        .replace(/\.(\d{3})(\d{1,2})$/, '.$1-$2');
      e.target.value = value;

      // feedback visual simples
      if (value.length === 14) {
        cpfInput.style.border = '1px solid #10b981';
        helper.textContent = 'CPF com formatação válida.';
      } else {
        cpfInput.style.border = '1px solid rgba(0,224,255,.20)';
        helper.textContent = '';
      }
    });
  }
});

/* Cadastro de usuário via API */
document.getElementById('formCadastro').addEventListener('submit', async function(e){
  e.preventDefault();

  const loginField  = document.getElementById('login').value.trim();
  const email       = document.getElementById('email').value.trim();
  const cpfRaw      = document.getElementById('cpf').value;
  const telefoneRaw = document.getElementById('telefone').value;
  const senha       = document.getElementById('senha').value;
  const senhaConf   = document.getElementById('senhaConfirma').value;

  // Nome e Login: por enquanto usamos o mesmo valor do campo "Nome Login"
  const nome  = loginField;
  const login = loginField;

  // Limpa CPF e telefone para só dígitos
  const cpf      = onlyDigits(cpfRaw);
  const telefone = onlyDigits(telefoneRaw);

  // Validações básicas
  if (!nome || !login || !email || !cpf || !telefone || !senha || !senhaConf) {
    alert("Preencha todos os campos.");
    return;
  }

  if (senha !== senhaConf) {
    alert("As senhas não coincidem!");
    return;
  }

  // 1 Admin, 2 Gestão, 3 ST, 4 Funcionário
  const typeUser = 4; // fixo por enquanto

  // Monta o body exatamente como o UsuarioCadastroDto espera
  const body = {
    nome,
    login,
    email,
    cpf,
    telefone,
    senha,
    confirmarSenha: senhaConf,
    typeUser
  };

  try {
    // Aqui eu assumo que você vai criar um endpoint POST /api/usuarios
    const response = await fetch(`${API_BASE}/api/usuarios`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    if (response.ok) {
      let resultado = null;
      try {
        resultado = await response.json();
      } catch {
        // se não vier JSON, beleza, só segue
      }

      alert(resultado?.message || "Usuário cadastrado com sucesso!");
      this.reset();
      // se quiser, depois redireciona pra tela de login:
      // window.location.href = "index.html";
      return;
    }

    if (response.status === 400) {
      const erro = await response.json().catch(() => null);
      alert(erro?.message || "Dados inválidos. Verifique as informações e tente novamente.");
      return;
    }

    if (response.status === 409) {
      const erro = await response.json().catch(() => null);
      alert(erro?.message || "Já existe um usuário com esse login ou CPF.");
      return;
    }

    alert("Erro no servidor ao cadastrar usuário. Tente novamente.");
  } catch (error) {
    alert("Erro ao conectar com o servidor: " + error.message);
  }
});
</script>


</body>
</html>
